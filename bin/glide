#!/bin/bash
# This file is generated by BuildEnv. Avoid updating it manually.
# Instead, contribute to BuildEnv and use 'be_update'
#

MOD=go
    
# From BuildEnv bin/pre-wrapper.sh

BUILD_SCRIPT_PATH=$(dirname $0)
BUILD_SCRIPT_LIB_PATH=$(dirname $BUILD_SCRIPT_PATH)/lib

if [[ ! -f $BUILD_SCRIPT_LIB_PATH/run-build-env.sh ]]
then
    echo "Unable to load build-env.sh. '$BUILD_SCRIPT_LIB_PATH/run-build-env.sh' not found"
    exit 1
fi

source $BUILD_SCRIPT_LIB_PATH/run-build-env.sh
# From BuildEnv:modules/go/bin/glide.sh

GOPATH=$(cd $GOPATH ; pwd)

if [[ "$(echo $@ | grep $GOPATH)" != "" ]] 
then
    printf "\e[1mbuild-env INFO!\e[0m Replacing $GOPATH by /go in 'docker run'.\n"
fi

eval "$(echo docker_run ${BE_PROJECT}-go-env /usr/bin/glide "$@" | sed 's|'$GOPATH'|/go|g')"
RET=$?

if [[ "$GO_MODULE_REF" != "" ]] && [[ "$GO_MODULE_REF" =~ ^[^/]*/[^/]*/$BE_PROJECT$ ]]
then
    if [[ ! -h vendor/$GO_MODULE_REF ]] && [[ -d vendor/$GO_MODULE_REF ]]
    then
        rm -fr vendor/$GO_MODULE_REF
        ln -s ../../.. vendor/$GO_MODULE_REF
    fi
fi
exit $RET